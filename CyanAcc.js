(()=>{"use strict";self.CacheDB=function(e,t,n){this.config=n||{auto:0},this.config.auto=this.config.auto||0,this.namespace=e||"CacheDBDefaultNameSpace",this.prefix=t||"CacheDBDefaultPrefix",this.has=async function(e){return new Promise(((t,n)=>{caches.open(this.namespace).then((n=>{n.match(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then((e=>t(!!e)))})).catch((e=>{console.error("CacheDB Has Erorr:"+e),n(!1)}))}))},this.read=async function(e,t){return(t=t||{}).type=t.type||(this.config.auto?"auto":"text"),await this.has(e)?new Promise(((n,a)=>{caches.open(this.namespace).then((a=>{a.match(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then((async e=>{if("auto"===t.type)switch(e.headers.get("Content-Type")){case"application/json":t.type="json";break;case"application/octet-stream":t.type="arrayBuffer";break;case"application/octet-stream":t.type="blob";break;case"text/number":t.type="number";break;case"text/boolean":t.type="boolean";break;default:t.type="text"}switch(t.type){case"number":return void n(Number(await e.text()));case"json":return void n(e.json());case"arrayBuffer":return void n(e.arrayBuffer());case"blob":return void n(e.blob());case"text":return void n(e.text());case"boolean":return void n(1==await e.text());default:return void n(e.body)}}))})).catch((e=>{console.error("CacheDB Read Erorr:"+e),a(null)}))})):t.default?(await this.write(e,t.default,t),t.default):(console.error("CacheDB Read Erorr: Key not found"),null)},this.write=async function(e,t,n){var a;switch((n=n||{}).type=n.type||(this.config.auto?"auto":"text"),"auto"===n.type&&(n.type="object"==typeof(a=t)&&null!==a&&a.constructor===Object||Array.isArray(a)?"json":typeof t),n.type){case"json":n.content_type="application/json",t=JSON.stringify(t);break;case"arrayBuffer":case"blob":n.content_type="application/octet-stream";break;case"number":n.content_type="text/number",t=t.toString();break;case"boolean":n.content_type="text/boolean",t=t?1:0}return new Promise(((a,i)=>{caches.open(this.namespace).then((i=>{i.put(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`),new Response(t,{headers:{"Content-Type":n.content_type}})).then(a(1))})).catch((e=>{console.error("CacheDB Write Erorr:"+e),i(0)}))}))},this.delete=async function(e){return new Promise(((t,n)=>{caches.open(this.namespace).then((n=>{n.delete(new Request(`https://${this.prefix}/${encodeURIComponent(e)}`)).then(t(!0))})).catch((e=>{console.error("CacheDB Delete Erorr:"+e),n(!1)}))}))},this.list=async function(){return new Promise(((e,t)=>{caches.open(this.namespace).then((t=>{t.keys().then((t=>{e(t.map((e=>decodeURIComponent(e.url.split("/").pop()))))}))})).catch((e=>{console.error("CacheDB List Erorr:"+e),t([])}))}))},this.all=async function(){const e={};return new Promise((async(t,n)=>{this.list().then((async n=>{await Promise.all(n.map((async t=>{e[t]=await this.read(t)}))),t(e)})).catch((e=>{console.error("CacheDB All Erorr:"+e),n([])}))}))},this.clear=async function(){return new Promise(((e,t)=>{this.list().then((t=>{t.forEach((e=>{this.delete(e)})),e(!0)})).catch((e=>{console.error("CacheDB Clear Erorr:"+e),t(!1)}))}))},this.destroy=async function(){return new Promise(((e,t)=>{this.clear().then((()=>{caches.delete(this.namespace).then(e(!0))})).catch((e=>{console.error("CacheDB Destroy Erorr:"+e),t(!1)}))}))}};const e={TarReader:class{constructor(){this.fileInfo=[]}readFile(e){return new Promise(((t,n)=>{let a=new FileReader;a.onload=e=>{this.buffer=e.target.result,this.fileInfo=[],this._readFileInfo(),t(this.fileInfo)},a.readAsArrayBuffer(e)}))}readArrayBuffer(e){return this.buffer=e,this.fileInfo=[],this._readFileInfo(),this.fileInfo}_readFileInfo(){this.fileInfo=[];let e=0,t=0,n="",a=null;for(;e<this.buffer.byteLength-512&&(n=this._readFileName(e),0!=n.length);)a=this._readFileType(e),t=this._readFileSize(e),this.fileInfo.push({name:n,type:a,size:t,header_offset:e}),e+=512+512*Math.trunc(t/512),t%512&&(e+=512)}getFileInfo(){return this.fileInfo}_readString(e,t){let n=new Uint8Array(this.buffer,e,t),a=n.indexOf(0);return(new TextDecoder).decode(n.slice(0,a))}_readFileName(e){return this._readString(e,100)}_readFileType(e){let t=new Uint8Array(this.buffer,e+156,1),n=String.fromCharCode(t[0]);return"0"==n?"file":"5"==n?"directory":n}_readFileSize(e){let t=new Uint8Array(this.buffer,e+124,12),n="";for(let e=0;e<11;e++)n+=String.fromCharCode(t[e]);return parseInt(n,8)}_readFileBlob(e,t,n){let a=new Uint8Array(this.buffer,e,t);return new Blob([a],{type:n})}_readFileBinary(e,t){return new Uint8Array(this.buffer,e,t)}_readTextFile(e,t){let n=new Uint8Array(this.buffer,e,t);return(new TextDecoder).decode(n)}getTextFile(e){let t=this.fileInfo.find((t=>t.name==e));if(t)return this._readTextFile(t.header_offset+512,t.size)}getFileBlob(e,t){let n=this.fileInfo.find((t=>t.name==e));if(n)return this._readFileBlob(n.header_offset+512,n.size,t)}getFileBinary(e){let t=this.fileInfo.find((t=>t.name==e));if(t)return this._readFileBinary(t.header_offset+512,t.size)}},TarWriter:class{constructor(){this.fileData=[]}addTextFile(e,t,n){let a=(new TextEncoder).encode(t);this.fileData.push({name:e,array:a,type:"file",size:a.length,dataType:"array",opts:n})}addFileArrayBuffer(e,t,n){let a=new Uint8Array(t);this.fileData.push({name:e,array:a,type:"file",size:a.length,dataType:"array",opts:n})}addFile(e,t,n){this.fileData.push({name:e,file:t,size:t.size,type:"file",dataType:"file",opts:n})}addFolder(e,t){this.fileData.push({name:e,type:"directory",size:0,dataType:"none",opts:t})}_createBuffer(){let e=0;for(let t=0;t<this.fileData.length;t++){let n=this.fileData[t].size;e+=512+512*Math.trunc(n/512),n%512&&(e+=512)}let t=10240*Math.trunc(e/10240);e%10240&&(t+=10240),this.buffer=new ArrayBuffer(t)}async download(e){let t=await this.writeBlob(),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}async writeBlob(e){return new Blob([await this.write(e)],{type:"application/x-tar"})}write(e){return new Promise(((t,n)=>{this._createBuffer();let a=0,i=0,r=()=>{if(i++,e&&e(i/this.fileData.length*100),i===this.fileData.length){let e=new Uint8Array(this.buffer);t(e)}};for(let e=0;e<this.fileData.length;e++){let t=this.fileData[e];this._writeFileName(t.name,a),this._writeFileType(t.type,a),this._writeFileSize(t.size,a),this._fillHeader(a,t.opts,t.type),this._writeChecksum(a);let n=new Uint8Array(this.buffer,a+512,t.size);if("array"===t.dataType){for(let e=0;e<t.size;e++)n[e]=t.array[e];r()}else if("file"===t.dataType){let e=new FileReader;e.onload=function(e){let t=e;return function(e){let n=e.target.result,a=new Uint8Array(n);for(let e=0;e<a.length;e++)t[e]=a[e];r()}}(n),e.readAsArrayBuffer(t.file)}else"directory"===t.type&&r();a+=512+512*Math.trunc(t.size/512),t.size%512&&(a+=512)}}))}_writeString(e,t,n){let a=new Uint8Array(this.buffer,t,n),i=new TextEncoder;if(i.encodeInto)for(let t=i.encodeInto(e,a).written;t<n;t++)a[t]=0;else{let t=i.encode(e);for(let e=0;e<n;e++)a[e]=e<t.length?t[e]:0}}_writeFileName(e,t){this._writeString(e,t,100)}_writeFileType(e,t){let n="0";"file"===e?n="0":"directory"===e&&(n="5"),new Uint8Array(this.buffer,t+156,1)[0]=n.charCodeAt(0)}_writeFileSize(e,t){let n=e.toString(8);n=this._leftPad(n,11),this._writeString(n,t+124,12)}_leftPad(e,t){let n=e+"";for(;n.length<t;)n="0"+n;return n}_writeFileMode(e,t){this._writeString(this._leftPad(e,7),t+100,8)}_writeFileUid(e,t){this._writeString(this._leftPad(e,7),t+108,8)}_writeFileGid(e,t){this._writeString(this._leftPad(e,7),t+116,8)}_writeFileMtime(e,t){this._writeString(this._leftPad(e,11),t+136,12)}_writeFileUser(e,t){this._writeString(e,t+265,32)}_writeFileGroup(e,t){this._writeString(e,t+297,32)}_writeChecksum(e){this._writeString("        ",e+148,8);let t=new Uint8Array(this.buffer,e,512),n=0;for(let e=0;e<512;e++)n+=t[e];this._writeString(n.toString(8),e+148,8)}_getOpt(e,t,n){return null!=e&&null!=e[t]?e[t]:n}_fillHeader(e,t,n){let a=this._getOpt(t,"uid",1e3),i=this._getOpt(t,"gid",1e3),r=this._getOpt(t,"mode","file"===n?"664":"775"),s=this._getOpt(t,"mtime",Date.now()),o=this._getOpt(t,"user","tarballjs"),c=this._getOpt(t,"group","tarballjs");this._writeFileMode(r,e),this._writeFileUid(a.toString(8),e),this._writeFileGid(i.toString(8),e),this._writeFileMtime(Math.trunc(s/1e3).toString(8),e),this._writeString("ustar",e+257,6),this._writeString("00",e+263,2),this._writeFileUser(o,e),this._writeFileGroup(c,e)}}},t=[{match:"(cdn|fastly)\\.jsdelivr\\.net",domain:"cdn.jsdelivr.net",concat:{npm:"/npm(/@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})(@{{PACKAGE_VERSION}})?(/{{$FILE_PATH}})?",github:"/gh/({{USER_NAME}})/({{REPO_NAME}})(@{{TAG_NAME}})?(/{{$FILE_PATH}})?"}},{match:"registry\\.npmmirror\\.com",domain:"registry.npmmirror.com",concat:{npm:"(/@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})(/{{PACKAGE_VERSION}})?/files(/{{$FILE_PATH}})?"},extra:{npm_meta:"(/@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})(/{{$PACKAGE_VERSION}})?",npm_registry:"(@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})/-/({{PACKAGE_NAME}})-({{PACKAGE_VERSION}}).tgz"}},{match:"registry\\.npmjs\\.org",domain:"registry.npmjs.org",concat:{},extra:{npm_meta:"(/@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})(/{{$PACKAGE_VERSION}})?",npm_registry:"(@{{PACKAGE_SCOPE}})?/({{PACKAGE_NAME}})/-/({{PACKAGE_NAME}})-({{PACKAGE_VERSION}}).tgz"}}],n=async e=>new Promise((async(t,n)=>{const a=new Event("abortOtherInstance"),i=new EventTarget,r=setTimeout((()=>{n(new Response("504 All GateWays Failed",{status:504,statusText:"504 All Gateways Timeout"}))}),5e3);await Promise.any(e.map((async e=>{"string"==typeof e&&(e=new Request(e));let n=new AbortController,s=!1;i.addEventListener(a.type,(()=>{s||n.abort()})),fetch(e,{signal:n.signal,mode:"cors",redirect:"follow"}).then((e=>{200===e.status&&(s=!0,i.dispatchEvent(a),clearTimeout(r),t(e.clone()))})).catch((e=>{"DOMException: The user aborted a request."==e&&console.log()}))}))).catch((e=>{n(e)}))}));self.CDNObject=function(a={}){this.config=Object.keys(a).length?a:{cdn:a.cdn?Object.assign({},t,a.cdn):t,cache:a.cache?a.cache:{LatestExpire:86400,UnuseExpire:2592e3}},this.CacheDB=e=>new CacheDB("CDNObject",e);const i=this,r=function(t){if(this.valid=!1,"string"!=typeof t&&"object"!=typeof t)throw new Error("Invalid URL");if(this.url=t,this.urlObject=new URL(t),this.id=i.config.cdn.findIndex((e=>new RegExp(e.match).test(t))),-1===this.id)throw new Error("CDN Not Found:"+t);for(var s in i.config.cdn[this.id].concat)if(this.matchRule=new RegExp(i.config.cdn[this.id].concat[s].replace(/\{\{\$(.*)\}\}/g,"(?<$1>.*)").replace(/\{\{(.*?)\}\}/g,"(?<$1>[^/@]+)").replace(/\//g,"\\/")),t.match(this.matchRule)){this.type=s;break}if(!this.type)throw new Error("CDN Prefix Not Found:"+t);if(this.domain=i.config.cdn[this.id].domain,this.var=t.match(this.matchRule).groups,this.valid=!0,this.genMirror=e=>{const t=i.config.cdn.findIndex((t=>t.domain===e));if(-1===t)throw new Error("CDN Mirror Not Found");if(!i.config.cdn[t].concat[this.type])throw new Error("This Mirror Has No Such Prefix: "+this.type+" ,It only has:"+Object.keys(i.config.cdn[t].concat).join(","));let n=`https://${i.config.cdn[t].domain}${i.config.cdn[t].concat[this.type]}`.replace(/\?/g,"");for(var a in this.var)n=n.replace(new RegExp(`\\(([^)]*)\\{\\{\\$?${a}\\}\\}([^(]*)\\)`,"g"),this.var[a]?`$1${this.var[a]}$2`:"");return new r(n)},this.getAllMirrors=()=>{const e=[];for(var t in i.config.cdn)i.config.cdn[t].concat[this.type]&&e.push({id:t,domain:i.config.cdn[t].domain,cdnObject:this.genMirror(i.config.cdn[t].domain),cdnUrl:this.genMirror(i.config.cdn[t].domain).url});return e},"npm"===this.type){if(this.getNewestVersion=async()=>{const e=["PACKAGE_SCOPE","PACKAGE_NAME"];let t=[];for(var a in i.config.cdn)if("object"==typeof i.config.cdn[a].extra&&i.config.cdn[a].extra.npm_meta){let n=`https://${i.config.cdn[a].domain}${i.config.cdn[a].extra.npm_meta}`;for(var r in this.var)n=n.replace(/\?/g,"").replace(new RegExp(`\\(([^)]*)\\{\\{\\$?${r}\\}\\}([^(]*)\\)`,"g"),-1!==e.indexOf(r)&&this.var[r]?`$1${this.var[r]}$2`:"");t.push(n)}return n(t).then((e=>e.json())).then((e=>e["dist-tags"].latest)).catch((e=>null))},"function"!=typeof a.ungzip)return void console.warn("CDNObject: ungzip function not found, pls import pako before inistantiating CDNObject,GetFileFromNPMPackageFunction will not work");const t=`${this.var.PACKAGE_SCOPE?"this.var.PACKAGE_SCOPE/":""}${this.var.PACKAGE_NAME}/${this.var.PACKAGE_VERSION}`;this.packageDownloaded=0,this.packageUntared=0,this.getPackage=async()=>{const e=i.CacheDB("npm_registry"),a=["PACKAGE_SCOPE","PACKAGE_NAME","PACKAGE_VERSION"];let r=[];for(var s in i.config.cdn)if("object"==typeof i.config.cdn[s].extra&&i.config.cdn[s].extra.npm_registry){let e=`https://${i.config.cdn[s].domain}${i.config.cdn[s].extra.npm_registry}`;for(var o in this.var)e=e.replace(/\?/g,"").replace(new RegExp(`\\(([^)]*)\\{\\{\\$?${o}\\}\\}([^(]*)\\)`,"g"),-1!==a.indexOf(o)&&this.var[o]?`$1${this.var[o]}$2`:"");r.push(e)}const c=await n(r).then((e=>e.arrayBuffer())).catch((e=>null));return await e.write(t,c,{type:"arrayBuffer"}),this.packageDownloaded=1,{CachePrefix:"npm_registry",CacheKey:t}},this.deletePackage=async()=>{if(!this.packageDownloaded)throw"need getPackage()";const e=i.CacheDB("npm_registry");return await e.delete(t),this.packageDownloaded=0,!0},this.untarPackage=async()=>{if(!this.packageDownloaded)throw"need getPackage()";const n=i.CacheDB("npm_registry"),a=i.CacheDB("npm"),r=await n.read(t,{type:"arrayBuffer"}),s=ungzip(new Uint8Array(r)),o=new Blob([s],{type:"application/octet-stream"});let c=new e.TarReader;return(await c.readFile(o)).forEach((async e=>{await a.write(`${t}/${e.name.replace(/^package\/?/g,"")}`,c.getFileBinary(e.name),{type:"arrayBuffer"})})),this.packageUntared=1,!0},this.getFileFromPackage=async()=>{if(!this.packageUntared)throw"need untarPackage()";if(!this.var.FILE_PATH)throw"need FILE_PATH";const e=i.CacheDB("npm"),n=`${t}/${this.var.FILE_PATH}`;return e.read(n,{type:"arrayBuffer"})}}};return r};const a={pool:[],add:function(e,t=!0,n=6e4,a="这个任务没有描述"){if(this.pool.push({enable:!0,function:e,interval:n,description:a,lastrun:{time:0}}),t)try{e().then((()=>{}))}catch(e){}},run:async function(e){return!!this.pool[e].enable&&!(this.pool[e].lastrun.time+this.pool[e].interval>(new Date).getTime())&&(await this.pool[e].function(),cons.i(`Persistent Task <${this.pool[e].description}> Runned Just Now`),void(this.pool[e].lastrun.time=(new Date).getTime()))},runAll:async function(){return Promise.all(this.pool.map((async(e,t)=>await this.run(t))))},stop:function(e){this.pool[e].enable=!1},start:function(e){this.pool[e].enable=!0},clear:function(){this.pool=[]}},i={s:e=>{console.log(`%c[SUCCESS]%c ${e}`,"color:white;background:green;","")},w:e=>{console.log(`%c[WARNING]%c ${e}`,"color:brown;background:yellow;","")},i:e=>{console.log(`%c[INFO]%c ${e}`,"color:white;background:blue;","")},e:e=>{console.log(`%c[ERROR]%c ${e}`,"color:white;background:red;","")},d:e=>{console.log(`%c[DEBUG]%c ${e}`,"color:white;background:black;","")}},r=new URL(self.location.href).host,s=async(e,t)=>(console.log(t),new Promise(((n,a)=>{const i=new Event("abortOtherInstance"),s=new EventTarget,o=setTimeout((()=>{n([new Response("504 All GateWays Failed,CyanAcc Returned",{status:504,statusText:"504 All Gateways Timeout"})])}),t.timeoutL2);try{Promise.any(e.map((async e=>{"string"==typeof e&&(e=new Request(e));let t=new AbortController,a=!1;return s.addEventListener(i.type,(()=>{a||t.abort()})),fetch(e,{signal:t.signal,mode:new URL(e.url).host===r?"same-origin":"cors",redirect:"follow"}).then((t=>{console.log(t),200===t.status&&(a=!0,s.dispatchEvent(i),clearTimeout(o),n([t.clone(),e]))})).catch((e=>{"DOMException: The user aborted a request."==e&&console.log()}))}))).catch((e=>{n([new Response("504 All GateWays Failed,CyanAcc Returned",{status:504,statusText:"504 All Gateways Timeout"})])}))}catch(e){n([new Response("504 All GateWays Failed,CyanAcc Returned",{status:504,statusText:"504 All Gateways Timeout"})])}}))),o=function(e,t,n){this.namespace="AssetsCache",this.urls=t,this.origin=e,n.origin&&t.push({url:e.url,weight:0,id:-1}),this.CacheConfig=n,this.IntelligentFetch=async function(){if(this.CacheConfig.parallel){let t=[new Response("IntelligentFetch Tried To Fetch:"+e.url,{status:500})];for(;200!==t[0].status;){const n=this.urls.slice(0,this.CacheConfig.threads);if(t=await s(n.map((t=>this.rebuild.request(e,t.url,this.CacheConfig.simpleFetch))),this.CacheConfig),200===t[0].status){this.urls.map((async e=>{if(e.url===t[1].url){if(-1===e.id)return;if(!CDN_Domain[e.id])return;CDN_Domain[e.id].weight++,setTimeout((async()=>{await db.write("CDN_Domain",JSON.stringify(self.CDN_Domain))}),0)}}));break}if(this.urls=this.urls.slice(this.CacheConfig.threads),0===this.urls.length)break}return t}return fetch(e)},this.rebuild={response:(e,t)=>{const n=new Response(e.body,t);return n.headers.set("Cache-Control","CyanAcc"),n.headers.set("Cache-Time",(new Date).getTime()),n.headers.set("Cache-L1",this.CacheConfig.cacheL1),n.headers.set("Cache-L2",this.CacheConfig.cacheL2),n},request:(e,t,n)=>n?new Request(t||e.url,{method:"GET"==e.method||"HEAD"==e.method||"POST"==e.method?e.method:"GET",body:"POST"==e.method?e.body:null}):new Request(t||e,{headers:e.headers,mode:"navigate"===e.mode?"same-origin":e.mode,...e})},this.fetch=async function(t=!1){return t?(await this.IntelligentFetch())[0]:new Promise((async(t,n)=>{const a=await caches.open(this.namespace);let i=new URL(this.origin.url);this.CacheConfig.ignore_search||(i.search="");const r=await a.match(new Request(i.toString())),s=async()=>{const e=(await this.IntelligentFetch())[0],t=this.rebuild.response(e.clone(),this.CacheConfig.onlyBody?{status:e.status,headers:{"content-type":i.pathname.endsWith(".html")?"text/html;charset=UTF-8":e.headers.get("content-type")}}:e.clone());return 200===e.status&&await a.put(new Request(i.toString()),t.clone()),t.clone()};if(r){if("CyanAcc"!==r.headers.get("Cache-Control"))return cons.w(`${e.url} Cannot Be Refreshed Because It Is Not A CyanAcc Cache`),void t(r);const n=(new Date).getTime()-Number(r.headers.get("Cache-Time"));n>Number(r.headers.get("Cache-L1"))?(cons.i(`${e.url} Is Expired L1,Refreshing...`),n>Number(r.headers.get("Cache-L2"))?(cons.i(`${e.url} Is Expired L2,Force Refreshing...`),t(await s())):t(Promise.any([s(),new Promise((async e=>{setTimeout((async()=>{e(r.clone())}),this.CacheConfig.timeoutL1)}))]))):t(r)}else t(await s())}))}},c={CDN_Fetch_Config:{enable:!0,onlyBody:!1,simpleFetch:!0,parallel:!0,ignore_search:!0,threads:2,origin:!0,timeoutL1:2e3,timeoutL2:5e3,cache:!0,cacheL1:6048e5,cacheL2:2592e6},Blog_Fetch_Config:{enable:!0,onlyBody:!0,simpleFetch:!0,parallel:!0,origin:!0,ignore_search:!0,domain:["blog.eurekac.cn","localhost:48080"],auto_update:{enable:!1,interval:144e5},mirrors:[{type:"url",var:{DOMAIN:"cyan-blog-three.vercel.app",PATH:"/"},weight:-7}],threads:2,timeoutL1:2e3,timeoutL2:5e3,cache:!0,cacheL1:36e5,cacheL2:864e5},CDN_Domain:[{match:"(cdn|fastly)\\.jsdelivr\\.net",domain:"cdn.jsdelivr.net",concat:{npm:"/npm(/@{{PACKAGE_SCOPE}})?/{{PACKAGE_NAME}}(@{{PACKAGE_VERSION}})?(/{{$FILE_PATH}})?",github:"/gh/{{USER_NAME}}/{{REPO_NAME}}/{{$FILE_PATH}}"},weight:0},{match:"cdnjs\\.cloudflare\\.com",domain:"cdnjs.cloudflare.com",concat:{cdnjs:"/ajax/libs/{{PACKAGE_NAME}}/{{PACKAGE_VERSION}}/{{$FILE_PATH}}"},weight:0},{match:"cdn\\.bootcdn\\.net",domain:"cdn.bootcdn.net",concat:{cdnjs:"/ajax/libs/{{PACKAGE_NAME}}/{{PACKAGE_VERSION}}/{{$FILE_PATH}}"},weight:0},{match:"unpkg\\.com",domain:"unpkg.com",concat:{npm:"/{{PACKAGE_NAME}}(@{{PACKAGE_VERSION}})?/{{$FILE_PATH}}"},weight:1},{match:"cdn\\.staticfile\\.org",domain:"cdn.staticfile.org",concat:{cdnjs:"/ajax/libs/{{PACKAGE_NAME}}/{{PACKAGE_VERSION}}/{{$FILE_PATH}}"},weight:0},{match:"registry\\.npmmirror\\.com",domain:"cdn.eurekac.cn",concat:{npm:"(/@{{PACKAGE_SCOPE}})?/{{PACKAGE_NAME}}(/{{PACKAGE_VERSION}})?/files(/{{$FILE_PATH}})"},weight:10}],CyanAcc_Config:{enable:!0,reinit:!0,PersistentTasks:{enable:!0,interval:1e3},AutoClear:{enable:!0,interval:6e4}}};self.cons=i;const l=new URL(self.location.href).protocol+"//"+new URL(self.location.href).host+"/panel",h=new CacheDB("CyanAcc","CyanAccDB",{auto:1}),f=async()=>{const e=await caches.open("AssetsCache"),t=await e.keys(),n=(new Date).getTime();for(var a of t){const t=await e.match(a);n-Number(t.headers.get("Cache-Time"))>Number(t.headers.get("Cache-L2"))&&await e.delete(a)}},d=e=>{let t=e.pathname||"/";return t=t.replace(/\/$/,"/index.html").replace(/^\//,""),t};addEventListener("fetch",(e=>{try{e.respondWith(u(e.request))}catch(t){return cons.e(`Fatal Error,CyanAcc Will Be disabled:${t}`),void e.respondWith(fetch(e.request))}})),addEventListener("install",(function(){self.skipWaiting()})),addEventListener("activate",(function(){try{self.clients.claim()}catch(e){console.log(e)}}));const u=async e=>{const t=new URL(e.url).host;for(void 0!==self.init&&self.init||(cons.i(`CyanAcc正在重新初始化...在${e.url}`),self.init=!0,self.initTime=(new Date).getTime(),self.Blog_Fetch_Config=await h.read("Blog_Fetch_Config",{default:c.Blog_Fetch_Config}),self.CDN_Domain=await h.read("CDN_Domain",{default:c.CDN_Domain}),self.CDN_Fetch_Config=await h.read("CDN_Fetch_Config",{default:c.CDN_Fetch_Config}),self.CyanAccConfig=await h.read("CyanAcc_Config",{default:c.CyanAcc_Config}),CyanAccConfig.PersistentTasks.enable&&void 0===self.CyanAccInterVal?(cons.i("CyanAcc正在启动持久任务池..."),CyanAccConfig.AutoClear.enable&&a.add(f,!1,CyanAccConfig.AutoClear.interval,"CyanAcc自动清理缓存进程"),self.CyanAccInterVal=setInterval((async()=>{await a.runAll()}),CyanAccConfig.PersistentTasks.interval)):cons.w("CyanAcc持久任务池被禁用或者已经启动"),self.initFinished=!0);!self.initFinished;)await new Promise((e=>setTimeout(e,100)));if(!CyanAccConfig.enable)return cons.w("CyanAcc已被禁用"),fetch(e);if(Blog_Fetch_Config.domain.includes(t))return p(e);for(var n of CDN_Domain)if(e.url.match(new RegExp(n.match)))return g(e);return fetch(e)},p=async e=>{const t=e.url,n=new URL(t);if(n.pathname.startsWith("/CyanAcc"))return w(e);if(!Blog_Fetch_Config.enable)return fetch(e);const a=d(n),i=Blog_Fetch_Config.mirrors.sort(((e,t)=>t.weight-e.weight)),r=[];for(var s of i)switch(s.type){case"url":r.push({url:`https://${s.var.DOMAIN}${s.var.PATH}${a}`,weight:s.weight,id:-1});break;case"npm":var c=new CDNObject(`https://cdn.eurekac.cn/npm/${s.var.PACKAGE_NAME}/${s.var.PACKAGE_VERSION}/files${s.var.PATH}${a}`),l=c.get_all_mirrors().sort(((e,t)=>t.weight-e.weight));for(var h of l)r.push({url:c.generate_mirror(h.domain).url,weight:s.weight+h.weight,id:h.id})}return new o(e,r,Blog_Fetch_Config).fetch()},g=async e=>{if(e=new Request(e.url.replace(/^http\:/g,"https:"),e),!CDN_Fetch_Config.enable)return fetch(e);const t=new CDNObject(e.url);if(!t.valid)return fetch(e);const n=t.get_all_mirrors().sort(((e,t)=>t.weight-e.weight));return new o(t,n.map((e=>({url:t.generate_mirror(e.domain).url,weight:e.weight,id:e.id}))),CDN_Fetch_Config).fetch()},w=async e=>{const t=new URL(e.url),n=async e=>{switch(e){case"js":return new Response(await(async()=>'console.log("CyanAcc自定义脚本执行成功")')(),{headers:{"content-type":"application/javascript;charset=UTF-8"}});case"css":return new Response(await(async()=>"")(),{headers:{"content-type":"text/css;charset=UTF-8"}});default:return new Response("Bad Request",{status:400})}};switch(t.pathname.replace("/CyanAcc","")){case"":return Response.redirect("/CyanAcc/");case"/custom.js":return n("js");case"/custom.css":return n("css");case"/api":return(async e=>{if("POST"!==e.method)return new Response("Method Not Allowed",{status:405});const t=await e.text();try{JSON.parse(t)}catch(e){return new Response("Bad Request",{status:400})}const n=JSON.parse(t);switch(n.action){case"PING":return new Response(JSON.stringify({status:"OK",data:"PONG"}));case"REINIT":return self.init=!1,new Response(JSON.stringify({status:"OK",data:"SET INIT AS FALSE"}));case"DUMP_VAR_TASKLIST":return new Response(JSON.stringify({status:"OK",data:a.pool}));case"GET_CACHE_SIZE":const e=await caches.open("AssetsCache"),t=await e.keys(),r=n.precise;let s=0;for(var i of t){const t=await e.match(i);s+=Number(await y(t,r))}return new Response(JSON.stringify({status:"OK",data:s}));case"GET_INIT_TIME":return new Response(JSON.stringify({status:"OK",data:self.initTime}));default:return new Response("Bad Request",{status:400})}})(e);default:return(async e=>{const n=await p(new Request(l+d(t).replace(/^CyanAcc/g,"")+(new URL(e.url).search||"")));return new Response(n.body,{headers:{"content-type":e.url.split("?")[0].endsWith(".html")?"text/html;charset=UTF-8":n.headers.get("content-type")}})})(e)}},y=async(e,t)=>{const n=e.headers,a=e.body;return t?(await e.arrayBuffer()).byteLength:n.get("content-length")||a.byteLength||(await e.arrayBuffer()).byteLength||0}})();