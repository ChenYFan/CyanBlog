<% if (theme.search == true && page.type == 'search') { %>
    <%- partial('_partial/search') %>
<% } else if (page.type == 'tags') { %>
    <%- partial('_partial/tags') %>
<% } else if (page.type == 'categories') { %>
    <%- partial('_partial/categories') %>
<% } else { %>
<article class="post">
    <canvas id='map'></canvas>
    <div class="meta">
        <% if (page.categories && page.categories.length) { %>
        <div class="categories<%= theme.uppercase_categories ? ' text-uppercase' : '' %>">
        <% page.categories.forEach((category) => { %>
            <a href="<%= config.root + category.path %>"><%= category.name %></a>
        <% }) %>
        </div>
        <% } %>

        <% if (!page.no_date) { %>
        <div class="date" id="date">
            <span><%= ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][page.date.month()] %></span>
            <span><%- page.date.date() %>,</span>
            <span><%- page.date.year() %></span>
        </div>
        <% } %>

        <h2 class="title"><%= page.title %></h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <%- page.content %>
    </div>
    
    <div class="divider"></div>
    <div class="container post-prev-next">
        <% if (page.prev) { %>
        <a href="<%= url_for(page.prev.path) %>" class="next">
            <div>
                <div class="text">
                    <p class="label"><%= __('next_post') %></p>
                    <h3 class="title"><%= page.prev.title %></h3>
                </div>
            </div>
        </a>
        <% } else { %><a class="next"></a><% } %>
        <% if (page.next) { %>
        <a href="<%= url_for(page.next.path) %>" class="prev">
            <div>
                <div class="text">
                    <p class="label"><%= __('prev_post') %></p>
                    <h3 class="title"><%= page.next.title %></>
                </div>
            </div>
        </a>
        <% } else { %><a class="prev"></a><% } %>
    </div>
    <div class="divider"></div>
    <% if (!page.no_about) { %>
    <div class="about">
        <h1><%= __('about_this_post') %></h1>
        <div class="details">
            <p><%- __('this_post_is_written_by', config.author) %>, <%- __('licensed_under', `<a href="${theme.license_link}">${theme.license}</a>`) %>.</p>
        </div>
        <% if (page.tags && page.tags.length) { %>
        <p class="tags<%= theme.capitalize_tags ? ' text-capitalize' : '' %>">
            <%
                var tags = ''
                page.tags.forEach((tag) => {
                    tags += `<a href="${config.root}${tag.path}" class="tag">${theme.hashtag_prefix_before_tags ? theme.hashtag_prefix : ''}${tag.name}</a>${theme.hashtag_prefix_before_tags ? '' : ','}`
                })
                if (!theme.hashtag_prefix_before_tags) { tags = tags.slice(0, tags.length - 1) }
            %>
            <%- tags %>
        </p>
        <% } %>
    </div>
    <% } %>

    

    <% if (!page.no_comments) { %>
        <div class="content container about" style="margin:8px auto">
            <div id="Comments">
                <p style="align-items: center;text-align: center;" id="comment_notice">Comment Will Load After 5s...</p>
            </div>
        </div>
        <script>
            const isElementVisible = (el) => {
                const rect = el.getBoundingClientRect()
                const vWidth = window.innerWidth || document.documentElement.clientWidth
                const vHeight = window.innerHeight || document.documentElement.clientHeight
                if (
                    rect.right < 0 ||
                    rect.bottom < 0 ||
                    rect.left > vWidth ||
                    rect.top > vHeight
                ) {
                    return false
                }

                return true
            }

            setTimeout(() => {
                const wait_comment_load = setInterval(async () => {
                    if (isElementVisible(document.getElementById("Comments"))) {
                        clearInterval(wait_comment_load)
                        document.getElementById("comment_notice").innerText = "Loading Comment Script..."
                        await loadJS("https://registry.npmmirror.com/artalk/2.5.5/files/dist/Artalk.js")
                        document.getElementById("comment_notice").innerText = "Loading Comment Style..."
                        await loadCSS("https://registry.npmmirror.com/artalk/2.5.5/files/dist/Artalk.css")
                        document.getElementById("comment_notice").innerText = "Loading Comment Frame..."
                        Artalk.init({
                            el: '#Comments',
                            pageKey: window.location.pathname,
                            pageTitle: "",
                            server: 'https://artalk.eurekac.cn',
                            site: 'CyanFalseの幻想乡♂'
                        })
                        Artalk.setDarkMode(window.darkMode)
                        
                    }
                }, 1000)
            }, 5000);
        </script>
        <% } %>
</article>
<% } %>