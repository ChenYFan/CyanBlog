(async()=>{window.$=e=>document.querySelector(e),window.$_=e=>document.getElementById(e),window.$$=e=>document.querySelectorAll(e),window.loadJS=async n=>new Promise((e,t)=>{var a=document.createElement("script");a.src=n,a.onload=e,a.onerror=t,document.head.appendChild(a)}),window.loadCSS=async n=>new Promise((e,t)=>{var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.href=n,document.getElementsByTagName("HEAD")[0].appendChild(a),a.onload=e,a.onerror=t}),window.notyf=new Notyf({duration:3e3,position:{x:"right",y:"bottom"},ripple:!0,dismissible:!0,types:[{type:"warn",background:"orange",icon:!1},{type:"info",background:"blue",icon:!1}]}),notyf.info=e=>notyf.open({type:"info",message:e}),notyf.warn=e=>notyf.open({type:"warn",message:e}),window.funcThrottle=(a,n)=>{var r=Date.now();return function(){var e=arguments,t=Date.now();n<=t-r&&(a.apply(this,e),r=Date.now())}},window.db=new CacheDB("CyanAcc","CyanAccDB",{auto:1}),setTimeout(()=>{loadCSS("https://registry.npmmirror.com/@chenyfan/npm-autosync/0.0.0-1729174143/files/data/npm/lxgw-wenkai-screen-webfont/1.1.0/files/style.css")},0);var e,t=$_("theme-nav");if(t.addEventListener("click",e=>{window.innerWidth<=720?(t.classList.contains("open")?t.style.height="":t.style.height=48+$("#theme-nav .nav-items").clientHeight+"px",t.classList.toggle("open")):t.classList.contains("open")&&(t.style.height="",t.classList.remove("open"))}),window.addEventListener("resize",e=>{t.classList.contains("open")&&(t.style.height=48+$("#theme-nav .nav-items").clientHeight+"px"),720<window.innerWidth&&t.classList.contains("open")&&(t.style.height="",t.classList.remove("open"))}),(async()=>{var e,t=await db.read("DarkModeSetting",{default:{auto:!0,auto_mode:"auto",force_mode:"light"},type:"json"});e="light",(t=t).auto?"time"==t.auto_mode?e=18<=(new Date).getHours()||(new Date).getHours()<=6?"dark":"light":window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"):e=t.force_mode,document.body.setAttribute("data-current-color-scheme",e),document.body.setAttribute("data-color-scheme",e),window.darkMode="dark"===e})(),document.body.attributes["data-toc"]){for(var a=document.getElementsByClassName("content")[0],n=document.body.attributes["data-toc-max-depth"].value,r="",o=1;o<=n;o++)r+="h"+o+",";var r=r.slice(0,-1),a=a.querySelectorAll(r),i=[],s=(a.forEach(e=>{var t=parseInt(e.tagName[1]),t="&nbsp;&nbsp;".repeat(2*(t-1))+(t<=1?"":"↳")+e.innerText;i.push({html:t,href:e.getElementsByClassName("headerlink")[0].attributes.href.value})}),document.createElement("div"));s.classList.add("toc");for(let e in i){var c=document.createElement("p"),l=document.createElement("a");l.href=i[e].href,l.innerHTML=i[e].html,c.appendChild(l),s.appendChild(c)}0!=s.children.length&&(document.getElementsByClassName("post")[0].getElementsByClassName("divider")[0].after(s),(a=document.createElement("div")).classList.add("divider"),s.after(a))}for(e of document.getElementsByClassName("highlight")){let t=e.classList[1];var d=`<span class="code-lang">${(()=>{var e=t.toUpperCase();switch(e){case"JS":return"JAVASCRIPT";case"TS":return"TYPESCRIPT";case"YML":return"YAML";case"SH":return"SHELL";default:return e}})()}</span>`;e.innerHTML=d+e.innerHTML}document.addEventListener("gesturestart",function(e){e.preventDefault()}),window.lazylistener=new IntersectionObserver(function(e){e.forEach(function(e){var t;e.isIntersecting&&((t=e.target).srcset=t.getAttribute("data-srcset"),lazylistener.unobserve(t),t.onload=function(){t.className+=" loaded"})})});a=()=>{Array.from($$("img.lazy")).forEach(function(e){e.classList.contains("loaded")||lazylistener.observe(e)})};if(setInterval(a,3e3),a(),window.addEventListener("scroll",window.funcThrottle(a,200)),$_("Comments")){var m=await db.read("CommentSetting",{default:{enable:!0,delay:5},type:"json"});m.enable?($_("comment_notice").innerText="Comment Will Load After "+m.delay+"s",setTimeout(()=>{let e=setInterval(async()=>{t($_("Comments"))&&(clearInterval(e),$_("comment_notice").innerText="Loading Comment Script...",await loadJS("https://registry.npmmirror.com/artalk/2.9.1/files/dist/Artalk.js"),$_("comment_notice").innerText="Loading Comment Style...",await loadCSS("https://registry.npmmirror.com/artalk/2.9.1/files/dist/Artalk.css"),$_("comment_notice").innerText="Loading Comment Frame...",window.artalk=Artalk.init({el:"#Comments",pageKey:window.location.pathname,pageTitle:"",server:"https://artalk.eurekac.cn",site:"CyanFalseの幻想乡♂"}),artalk.setDarkMode(window.darkMode))},1e3)},1e3*m.delay)):$_("comment_notice").innerText="Comment Disabled by Your Config";let t=e=>{var e=e.getBoundingClientRect(),t=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>t||e.top>a)}}})(),(async()=>{var e,t;$_("map")&&(window.loadPageMap=e=>{$_("map").id="map-predelete";var t=document.createElement("canvas"),t=(t.id="map",$_("map-predelete").insertAdjacentElement("afterend",t),$_("map-predelete").remove(),e?"255,255,255":"0,0,0");pagemap($_("map"),{viewport:null,styles:{"header,footer,section,article":"rgba("+t+",0.08)",h1:"rgba("+t+",0.10)","h2,h3,h4":"rgba("+t+",0.08)",pre:"rgba("+t+",0.05)"},back:"rgba("+t+",0.02)",view:"rgba("+t+",0.05)",drag:"rgba("+t+",0.10)",interval:null}),$_("map").addEventListener("mouseover",()=>{$_("map").classList.remove("fadeout"),$_("map").classList.add("fadein")}),$_("map").addEventListener("mouseout",()=>{$_("map").classList.remove("fadein"),$_("map").classList.add("fadeout")});let a=$_("map"),n=null;document.addEventListener("scroll",()=>{a.classList.remove("fadeout"),a.classList.add("fadein"),n&&clearTimeout(n),n=setTimeout(()=>{a.classList.remove("fadein"),a.classList.add("fadeout")},1e3)})},loadPageMap(window.darkMode,!0)),window.db=new CacheDB("CyanAcc","CyanAccDB"),"never"===await db.read("needInstall",{default:"false"})?console.log("CyanAcc已禁用"):"serviceWorker"in navigator?((new Date).getTime()>Number(await db.read("install_time",{default:0,type:"number"}))+36e5&&(t=await db.read("Blog_Version",{default:0,type:"number"}))<(e=Number((await fetch("/package.json?__t="+(new Date).getTime(),{headers:{"no-CyanAcc":"true"}}).then(e=>e.json()).then(e=>e.version)).split("-")[1]))&&(0!==t&&notyf.info(new Date(e).toLocaleString("zh-CN",{month:"long",day:"numeric"})+"博客更新已发布，</br>正在更新..."),await db.write("Blog_Version",e),await db.write("install_time",(new Date).getTime()),await db.write("needInstall","true")),"true"===await db.read("needInstall",{default:"false"})&&(0<(t=await navigator.serviceWorker.getRegistrations().then(e=>e.filter(e=>e.active&&e.active.scriptURL.includes("CyanAcc.js")))).length?(await t[0].update(),notyf.success("CyanAcc已更新！"),await db.write("install_time",(new Date).getTime()),await db.write("needInstall","false")):navigator.serviceWorker.register("/CyanAcc.js").then(async t=>{let a=0,n=setInterval(()=>{fetch("/CyanAcc/api",{method:"POST",body:JSON.stringify({action:"PING"})}).then(e=>e.json()).then(async e=>{"PONG"===e.data&&(notyf.success("CyanAcc安装成功！"),clearInterval(n),await db.write("needInstall","false"))}).catch(e=>{console.log(`CyanAcc检查失败，正在重试第${a}次`),10<++a&&(notyf.error({message:"CyanAcc安装后无成功响应！将不会再尝试安装！</br>正在卸载已安装的CyanAcc...</br>详细信息请查看控制台",duration:1e4}),console.error(e),clearInterval(n),db.write("needInstall","never"),t.unregister())})},1e3)}).catch(async e=>{notyf.error({message:"CyanAcc安装失败！</br>将不会再尝试启动CyanAcc</br>请点击右上角设置手动安装</br>详细信息请查看控制台",duration:1e4}),console.error(e),await db.write("needInstall","never")}))):"https:"!==location.protocol?notyf.error("请使用HTTPS协议以启用CyanAcc"):(notyf.error("您的浏览器不支持或被广告插件禁用ServiceWorker</br>已直接禁用CyanAcc"),await db.write("needInstall","never"))})();